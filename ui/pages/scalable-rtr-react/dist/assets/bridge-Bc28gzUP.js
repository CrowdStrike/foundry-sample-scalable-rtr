import{B as N}from"./crowdstrike-Hlm6XwJE.js";import{o as i,b as M,u as c,_ as b,a as d,s as o,n as T,l as a,c as f,D as Z}from"./index-CYn3AU3C.js";import"./animation-Bdj22YQ5.js";import"./react-vendor-M_unPAe0.js";import"./shoelace-DUZrpg6v.js";const I=[{id:"abc123",name:"Mitre hosts"},{id:"def456",name:"RTR hosts"},{id:"ghi789",name:"Response hosts"}],j=[{name:"groups",buckets:[{label:"abc123",count:42},{label:"def456",count:23}]}],y=[{device_id:"xyz987",hostname:"Odysseus"},{device_id:"mno654",hostname:"Agamemnon"},{device_id:"pqr321",hostname:"Achilles"}],E=[{uuid:"uuid1",cid:"cid",uid:"f.bird@crowdstrike.com",first_name:"Falcon",last_name:"Bird",created_at:"2023-09-12T14:35:46Z"},{uuid:"uuid2",cid:"cid",uid:"p.bird@crowdstrike.com",first_name:"Peregrine",last_name:"Bird",created_at:"2023-09-12T14:35:46Z"},{uuid:"uuid3",cid:"cid",uid:"r.dino@crowdstrike.com",first_name:"Raptor",last_name:"Dino",created_at:"2023-09-12T14:35:46Z"}],H={id:"1",draft:!0,version:0,user_id:"dummy",user_name:"dummy",name:"First Job RTR",description:"First Job RTR",notification_emails:null,notifications:null,tags:null,host_count:I.length,run_count:0,total_recurrences:0,action:{type:"buildQuery",query_type:"file",query_file_paths:["azerty","qwerty"]},schedule:{time_cycle:"5 4 * * *",start_date:"2023-08-31T04:05",end_date:"2023-09-02T23:59"},target:{host_groups:I.map(n=>n.id),hosts:null,offline_queueing:!0},run_now:!1,next_run:"2023-08-31T08:25:17.179Z",last_run:"2023-08-31T08:25:17.179Z",created_at:"2023-08-31T08:25:17.179Z",updated_at:"2023-08-31T08:25:17.179Z",deleted_at:"2023-08-31T08:25:17.179Z"},$={id:"2",draft:!1,version:0,user_id:"dummy",user_name:"dummy",name:"Second Job RTR",description:"Second Job RTR",notification_emails:null,notifications:null,tags:null,host_count:y.length,run_count:0,total_recurrences:3,action:{type:"buildQuery",query_type:"registryKey",registry_keys:[{key:"hello",value:"world"}]},schedule:{time_cycle:"5 4 * * *",start_date:"2023-08-31T04:05",end_date:"2023-09-02T23:59"},target:{host_groups:null,hosts:y.map(n=>n.device_id),offline_queueing:!0},run_now:!1,next_run:"2023-08-31T08:25:17.179Z",last_run:"2023-08-31T08:25:17.179Z",created_at:"2023-08-31T08:25:17.179Z",updated_at:"2023-08-31T08:25:17.179Z",deleted_at:"2023-08-31T08:25:17.179Z"},G={id:"3",draft:!1,version:0,user_id:"dummy",user_name:"dummy",name:"Third Job RTR",description:"Third Job RTR",notification_emails:null,notifications:null,tags:null,host_count:y.length,run_count:0,total_recurrences:90,action:{type:"buildQuery",query_type:"registryKey",registry_keys:[{key:"hello",value:"world"}]},schedule:{time_cycle:"5 4 * * *",start_date:"2023-08-31T04:05",end_date:"2023-09-02T23:59"},target:{host_groups:null,hosts:y.map(n=>n.device_id),offline_queueing:!0},run_now:!1,next_run:"2023-08-31T08:25:17.179Z",last_run:"2023-08-31T08:25:17.179Z",created_at:"2023-08-31T08:25:17.179Z",updated_at:"2023-08-31T08:25:17.179Z",deleted_at:"2023-08-31T08:25:17.179Z"},V={id:"4",draft:!1,version:0,user_id:"dummy",user_name:"dummy",name:"Fourth Job RTR",description:"Fourth Job RTR",notification_emails:null,notifications:null,tags:null,host_count:y.length,run_count:0,total_recurrences:0,action:{type:"buildQuery",query_type:"registryKey",registry_keys:[{key:"hello",value:"world"}]},schedule:{time_cycle:"5 4 * * *",start_date:"2023-08-31T04:05",end_date:"2023-09-02T23:59"},target:{host_groups:null,hosts:y.map(n=>n.device_id),offline_queueing:!0},run_now:!1,next_run:"2023-08-31T08:25:17.179Z",last_run:"2023-08-31T08:25:17.179Z",created_at:"2023-08-31T08:25:17.179Z",updated_at:"2023-08-31T08:25:17.179Z",deleted_at:"2023-08-31T08:25:17.179Z"},Q={id:"5",draft:!1,version:0,user_id:"dummy",user_name:"dummy",name:"Fifth Job RTR",description:"Fifth Job RTR",notification_emails:null,notifications:null,tags:null,host_count:y.length,run_count:0,total_recurrences:0,action:{type:"buildQuery",query_type:"registryKey",registry_keys:[{key:"hello",value:"world"}]},schedule:{time_cycle:"5 4 * * *",start_date:"2023-08-31T04:05",end_date:"2023-09-02T23:59"},target:{host_groups:null,hosts:y.map(n=>n.device_id),offline_queueing:!0},run_now:!1,next_run:"2023-08-31T08:25:17.179Z",last_run:"2023-08-31T08:25:17.179Z",created_at:"2023-08-31T08:25:17.179Z",updated_at:"2023-08-31T08:25:17.179Z",deleted_at:"2023-08-31T08:25:17.179Z"},B={id:"6",draft:!1,version:0,user_id:"dummy",user_name:"dummy",name:"Sixth Job RTR",description:"Sixth Job RTR",notification_emails:null,notifications:null,tags:null,host_count:y.length,run_count:0,total_recurrences:0,action:{type:"buildQuery",query_type:"registryKey",registry_keys:[{key:"hello",value:"world"}]},schedule:{time_cycle:"5 4 * * *",start_date:"2023-08-31T04:05",end_date:"2023-09-02T23:59"},target:{host_groups:null,hosts:y.map(n=>n.device_id),offline_queueing:!0},run_now:!1,next_run:"2023-08-31T08:25:17.179Z",last_run:"2023-08-31T08:25:17.179Z",created_at:"2023-08-31T08:25:17.179Z",updated_at:"2023-08-31T08:25:17.179Z",deleted_at:"2023-08-31T08:25:17.179Z"},U={id:"1",job_id:"1",execution_id:"1",name:"First Job RR",run_date:"2023-08-11 09:35:29",duration:"00:12:21",status:"completed",hosts:["host1"],numHosts:1,receivedFiles:2,endDate:"2023-08-09 13:42:34"},K={id:"2",job_id:"2",execution_id:"2",name:"CVE-2023-123457",run_date:"2023-08-08 13:42:34",duration:"00:02:47",status:"completed",hosts:["host1","host2"],numHosts:2,receivedFiles:2,endDate:"2023-08-09 13:42:34"},O={id:"1",job_id:"1",job_name:"CVE-2023-123456",modified_at:"2023-08-11 09:35:29",version:1,modified_by:"g.thegrey@crowdstrike.com",action:"Created JobRTR"},z={id:"2",job_id:"2",job_name:"CVE-2023-123457",modified_at:"2023-08-11 09:35:29",version:1,modified_by:"a.elessar@crowdstrike.com",action:"Created JobRTR"};function P(n){return n.type==="api"}function W(n){return P(n)&&n.api==="faasGateway"}function X(n){return P(n)&&n.api==="devices"}function Y(n){return P(n)&&n.api==="userManagement"}class ee{isMatch(e){return X(e)&&(e.method==="postAggregatesDevicesGetV1"||e.method==="getEntitiesGroupsV1"||e.method==="postEntitiesDevicesV2"||e.method==="getQueriesDevicesV2")}async responder(e){let t={};if(e.method==="postAggregatesDevicesGetV1")t={errors:[],resources:j};else if(e.method==="getEntitiesGroupsV1")t={errors:[],resources:I};else if(e.method==="getQueriesDevicesV2"){const r=y.map(s=>s.device_id);t={errors:[],resources:r}}else e.method==="postEntitiesDevicesV2"&&(t={errors:[],resources:y});return Promise.resolve(t)}}class te{isMatch(e){return Y(e)&&(e.method==="postEntitiesUsersGetV1"||e.method==="getQueriesUsersV1")}async responder(e){let t={};return e.method==="postEntitiesUsersGetV1"?t={errors:[],resources:E}:e.method==="getQueriesUsersV1"&&(t={errors:[],resources:E.map(r=>r.uuid)}),Promise.resolve(t)}}const C=i({type:a("buildQuery"),query_type:a("file"),query_file_paths:d(o())}),L=i({type:a("buildQuery"),query_type:a("registryKey"),registry_keys:d(i({key:o(),value:o()}))});i({user_id:o(),user_name:o(),version:T(),id:o(),name:o(),description:o(),notification_emails:c([b(),d(o())]).optional(),notifications:c([b(),d(o())]),draft:M(),tags:c([b(),d(o())]),host_count:T(),run_count:T(),total_recurrences:T(),action:c([C,L]),schedule:c([i({time_cycle:o().nullable().optional().default(null),start_date:o(),end_date:o().nullable().optional().default(null)}),b()]),target:i({host_groups:c([b(),d(o())]),hosts:c([b(),d(o())]),offline_queueing:M()}),run_now:M(),next_run:o(),last_run:o(),created_at:o(),updated_at:o(),deleted_at:o()});const oe=i({user_id:o(),user_name:o(),version:T(),name:o(),description:o(),notifications:c([b(),d(o())]),tags:c([b(),d(o())]),action:c([C,L]),run_now:M(),schedule:c([i({time_cycle:o().nullable().optional().default(null),start_date:o(),end_date:o().nullable().optional().default(null)}),b()]),target:i({host_groups:c([b(),d(o())]),hosts:c([b(),d(o())]),offline_queueing:M()})}),ne=i({method:o(),payload:i({body:i({function_id:o().optional(),function_name:o().optional(),payload:i({path:o()})})})}),se=i({function_id:o().optional(),function_name:o().optional(),function_version:T(),payload:i({params:i({query:i({draft:d(c([a("true"),a("false")]))}).optional()}).optional(),body:oe})}),ie=i({payload:i({body:i({payload:i({params:i({query:i({fieldName:c([a("name"),a("description"),a("last_run_date"),a("next_run_date"),a("hosts"),a("last_modified"),a("draft")]).optional(),direction:c([a("ASC"),a("DESC")]).optional(),limit:c([d(a("5")),d(a("10")),d(a("15")),d(a("20"))]).optional(),offset:d(o()).optional(),prev:d(o()).optional(),next:d(o()).optional()}).optional()}).optional()})})})}),re=i({payload:i({body:i({payload:i({params:i({query:i({id:d(o())})})})})})}),D=":";class w{functionId="mock-faas-function";functionName="mock-faas-function-name";requestPath="/mock-path";counter=0;bus={};db;appName;constructor({db:e,appName:t}){this.db=e,this.appName=t}isMatch(e){return W(e)&&(this.isPost(e)||this.isGet(e))}isPost(e){const t=ne.safeParse(e);if(!t.success)return!1;const{method:r}=t.data,{function_id:s,function_name:u}=t.data.payload.body,{path:l}=t.data.payload.body.payload;return r==="postEntitiesExecutionV1"&&(s===this.functionId||u===this.functionName)&&l===this.requestPath}isGet(e){const{id:t}=e.payload.params;if(typeof t!="string")return!1;const[r,s,u,l]=t.split(D);return e.method==="getEntitiesExecutionV1"&&(r===this.functionId||s===this.functionName)&&u===this.requestPath}prepareResponse(e){return{errors:[],resources:[]}}async responder(e){if(this.isPost(e)){const t=[this.functionId,this.functionName,this.requestPath,++this.counter].join(D);return this.bus[t]=this.prepareResponse(e),Promise.resolve({resources:[{execution_id:t,function_id:this.functionId}]})}else if(this.isGet(e)){const{id:t}=e.payload.params;if(!t||typeof t!="string")throw"No id supplied";if(!this.bus[t])throw`No response for id: ${t}`;return Promise.resolve(this.bus[t])}}}class ae extends w{constructor(e){super(e),this.functionId=f.createJob.id,this.functionName=f.createJob.name,this.requestPath=f.createJob.path}prepareResponse(e){if(!("body"in e.payload))throw`CreateJobHandler received bad message: ${e.toString()}`;const r=se.safeParse(e.payload.body);if(r.success){const s=this.db.jobs.findIndex(g=>g.name===r.data.payload.body.name);if(s>-1&&this.db.jobs[s].draft===!1)return{resources:[{function_id:this.functionId,function_name:this.functionName,function_version:1,payload:{body:null,errors:[{field:"jobName",message:`Job name "${r.data.payload.body.name}" already exists"`,code:102}],status_code:400}}]};const[u]=r.data.payload.params?.query?.draft??["false"],{version:l,..._}=r.data.payload.body,h={id:s>-1?this.db.jobs[s].id:(Math.random()+1).toString(36).substring(7),version:l+1,draft:u==="true",total_recurrences:0,run_count:0,host_count:0,next_run:"2023-12-01T12:00",last_run:"",created_at:"2023-12-01T12:00",updated_at:"2023-12-01T12:00",deleted_at:"",notification_emails:_.notifications,..._};return s===-1?this.db.jobs.unshift(h):s>-1&&this.db.jobs[s].draft===!0&&(this.db.jobs[s]=h),{errors:[],resources:[{function_id:this.functionId,function_name:this.functionName,function_version:1,payload:{body:{resource:"a_random_uid"},errors:[],status_code:200}}]}}else return{resources:[{function_id:this.functionId,function_name:this.functionName,function_version:1,payload:{body:null,errors:r.error.issues.map(s=>({message:s.message})),status_code:400}}]}}}i({job_name:o(),modified_at:o(),version:T(),modified_by:o(),action:o(),id:o(),job_id:o()});const de=i({payload:i({body:i({payload:i({params:i({query:i({fieldName:c([a("name"),a("date_modified"),a("version"),a("modified_by"),a("action_taken")]).optional(),direction:c([a("ASC"),a("DESC")]).optional(),limit:c([d(a("5")),d(a("10")),d(a("15")),d(a("20"))]).optional(),offset:d(o()).optional(),prev:d(o()).optional(),next:d(o()).optional(),page:T().optional(),id:d(o()).optional(),filter:d(o()).optional()}).optional()}).optional()})})})}),A=10;function ue(n,e,t){const r=Math.ceil((t+1)/e);return t===-1?{paginatedJobs:n,page:r}:{paginatedJobs:n.slice(t,t+(e+1)),page:r}}function ce(n,e,t,r,s){let u=n.findIndex(p=>p.id===t);s!==""?u=n.findIndex(p=>p.id===s):r!==""&&(u=n.findIndex(p=>p.id===r));const{paginatedJobs:l,page:_}=ue(n,e,u),m=n[u-e]?.id?`${n[u-e]?.id}:${_-1}`:"",h=n.slice(-1),g=l.length===e+1?`${h[0]?.id}:${_}`:"";return{currentPage:e?l.slice(0,e):l,prevCursor:m,nextCursor:g}}class le extends w{constructor(e){super(e),this.functionId=f.getAuditLog.id,this.functionName=f.getAuditLog.name,this.requestPath=f.getAuditLog.path}prepareResponse(e){const{logs:t}=this.db,s=de.parse(e).payload.body.payload.params?.query??{},{offset:u=null,limit:l=[String(A)],prev:_=null,next:m=null}=s,h=u?.[0]??"",g=_?.[0].split(":")?.[0]??"",R=m?.[0].split(":")?.[0]??"",p=parseInt(l[0])??A;let v=t;if(s&&s.filter&&s.filter.length>0){const[Re,F]=s.filter[0].split(":");v=t.filter(S=>F.includes(S.job_id))}const{prevCursor:q,nextCursor:x,currentPage:J}=ce(v,p,h,g,R);return{errors:[],resources:[{function_id:this.functionId,function_version:1,payload:{body:{resources:v,meta:{total:t.length,limit:p,offset:J[0]?.id||"",count:J.length,prev:q,next:x}}}}]}}}class pe extends w{constructor(e){super(e),this.functionId=f.getJobDetails.id,this.functionName=f.getJobDetails.name,this.requestPath=f.getJobDetails.path}prepareResponse(e){const{jobs:t}=this.db,s=re.parse(e).payload.body.payload.params.query??{},u=t.find(l=>s.id.includes(l.id));return{errors:[],resources:[{function_id:this.functionId,function_version:1,payload:{body:{resource:u}}}]}}}function _e(n,e,t){const r=Math.ceil((t+1)/e);return t===-1?{paginatedJobs:n,page:r}:{paginatedJobs:n.slice(t,t+(e+1)),page:r}}function fe(n,e,t,r,s){let u=n.findIndex(p=>p.id===t);s!==""?u=n.findIndex(p=>p.id===s):r!==""&&(u=n.findIndex(p=>p.id===r));const{paginatedJobs:l,page:_}=_e(n,e,u),m=n[u-e]?.id?`${n[u-e]?.id}:${_-1}`:"",h=n.slice(-1),g=l.length===e+1?`${h[0]?.id}:${_}`:"";return{currentPage:e?l.slice(0,e):l,prevCursor:m,nextCursor:g}}class he extends w{constructor(e){super(e),this.functionId=f.getJobs.id,this.functionName=f.getJobs.name,this.requestPath=f.getJobs.path}prepareResponse(e){const{jobs:t}=this.db,s=ie.parse(e).payload.body.payload.params?.query??{},{offset:u=null,limit:l=[String(Z)],prev:_=null,next:m=null}=s,h=u?.[0]??"",g=_?.[0].split(":")?.[0]??"",R=m?.[0].split(":")?.[0]??"",p=parseInt(l[0])??Z,v=t,{prevCursor:q,nextCursor:x,currentPage:J}=fe(v,p,h,g,R);return{errors:[],resources:[{function_id:this.functionId,function_version:1,payload:{body:{resources:J,meta:{total:t.length,limit:p,offset:J[0]?.id||"",count:J.length,prev:q,next:x}}}}]}}}i({id:o(),job_id:o(),execution_id:o(),name:o(),duration:o(),hosts:d(o()),numHosts:T(),receivedFiles:T(),run_date:o(),endDate:o(),status:o()});const ye=i({payload:i({body:i({payload:i({params:i({query:i({fieldName:c([a("name"),a("run_date"),a("status"),a("duration"),a("hosts")]).optional(),direction:c([a("ASC"),a("DESC")]).optional(),limit:c([d(a("5")),d(a("10")),d(a("15")),d(a("20"))]).optional(),offset:d(o()).optional(),prev:d(o()).optional(),next:d(o()).optional(),id:d(o()).optional(),filter:d(o()).optional(),exact_name:d(o()).optional()}).optional()}).optional()})})})}),k=10;function me(n,e,t){const r=n.findIndex(s=>s.id===t);return n[r-e]?.job_id||""}function ge(n,e,t){const r=n.findIndex(s=>s.id===t);return r===-1?n:n.slice(r,r+(e+1))}function be(n,e,t){const r=ge(n,e,t),s=me(n,e,t),u=n.slice(-1),l=r.length===e+1?u[0]?.id:"";return{currentPage:e?r.slice(0,e):r,prevCursor:s,nextCursor:l}}class Te extends w{constructor(e){super(e),this.functionId=f.getRunHistory.id,this.functionName=f.getRunHistory.name,this.requestPath=f.getRunHistory.path}prepareResponse(e){const{history:t}=this.db,s=ye.parse(e).payload.body.payload.params?.query??{},{offset:u=null,limit:l=[String(k)]}=s,_=u?.[0]??"",m=parseInt(l[0])??k;let h=t;if(s&&s.filter&&s.filter.length>0){const v=s.filter[0].split(":")[0],q=s.filter[0].split(":")[1];h=t.filter(x=>{if(v==="job_name"&&(s.exact_name?.length??!1))return s.exact_name?.[0]==="true"?q===x.name:q.includes(x.name);if(v==="job_id")return x.job_id===q})}const{prevCursor:g,nextCursor:R,currentPage:p}=be(h,m,_);return{errors:[],resources:[{function_id:this.functionId,function_version:1,payload:{body:{resources:p,meta:{total:h.length,limit:m,count:p.length,prev:g,next:R}}}}]}}}const ve={jobs:[],history:[],logs:[]},Ie={jobs:[H,$,G,V,Q,B],history:[U,K],logs:[O,z]};class Pe extends N{createJob;getJobs;getJobDetails;getAuditLog;getRunHistory;devices;userManagement;db;constructor({db:e,appName:t}={db:ve,appName:"rapid-response"}){super(),this.db=e,this.createJob=new ae({db:this.db,appName:t}),this.getJobs=new he({db:this.db,appName:t}),this.getJobDetails=new pe({db:this.db,appName:t}),this.getAuditLog=new le({db:this.db,appName:t}),this.getRunHistory=new Te({db:this.db,appName:t}),this.devices=new ee,this.userManagement=new te}async postMessage(e){let t;if(this.devices.isMatch(e)?t=await this.devices.responder(e):this.userManagement.isMatch(e)?t=await this.userManagement.responder(e):this.getJobs.isMatch(e)?t=await this.getJobs.responder(e):this.createJob.isMatch(e)?t=await this.createJob.responder(e):this.getJobDetails.isMatch(e)?t=await this.getJobDetails.responder(e):this.getAuditLog.isMatch(e)?t=await this.getAuditLog.responder(e):this.getRunHistory.isMatch(e)?t=await this.getRunHistory.responder(e):t=await super.postMessage(e),!t)throw new Error("Woops!");return console.log("MockBridge#postMessage: ",{message:e,value:t}),t}}export{Pe as MockBridge,ve as emptyScenario,Ie as populatedScenario};
